<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Edit Demand</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 2rem;
      position: relative;
    }

    .main-content {
      display: flex;
      gap: 30px;
      justify-content: flex-start;
    }

    .form-container {
      width: 350px;
      flex-shrink: 0;
    }

    .stage-section {
      width: 900px;
      background-color: white;
      border: 1px solid #ddd;
      border-radius: 5px;
      padding: 15px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      flex-shrink: 0;
    }

    .form-content {
      display: flex;
      gap: 30px;
      justify-content: flex-start;
    }

    .form-fields {
      width: 350px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .form-field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-weight: 500;
      font-size: 14px;
      color: #333;
      margin-bottom: 2px;
    }

    input,
    select {
      width: 100%;
      padding: 10px 12px;
      font-size: 14px;
      border: 1px solid #000;
      border-radius: 4px;
      background-color: #fff;
      box-sizing: border-box;
    }

    input:focus,
    select:focus {
      outline: none;
      border-color: #1f78b4;
      box-shadow: 0 0 0 2px rgba(31, 120, 180, 0.1);
    }

    input[type="submit"] {
      background-color: #1f78b4;
      color: white;
      padding: 12px 16px;
      border: none;
      cursor: pointer;
      font-size: 14px;
      border-radius: 4px;
      font-weight: 500;
      margin-top: 8px;
    }

    input[type="submit"]:hover {
      background-color: #166494;
    }

    a {
      display: inline-block;
      margin-top: 1rem;
      text-decoration: none;
      color: #1f78b4;
    }

    /* Stage checklist styles */
    .stage-title {
      font-weight: bold;
      font-size: 18px;
      margin-bottom: 15px;
      text-align: center;
    }

    .stage-list {
      display: flex;
      flex-direction: row;
      gap: 20px;
      height: 355px;
      width: 100%;
    }

    .stage-column {
      display: flex;
      flex-direction: column;
      gap: 5px;
      width: calc(33.33% - 10px);
    }

    .stage-item {
      display: flex;
      align-items: center;
      padding: 6px 8px;
      border: 1px solid #f0f0f0;
      border-radius: 3px;
      min-height: 32px;
      background-color: #fafafa;
    }

    .stage-item:hover {
      background-color: #f0f0f0;
    }

    .stage-item label {
      display: flex;
      align-items: center;
      cursor: pointer;
      width: 100%;
      margin: 0;
      font-size: 13px;
      line-height: 1.3;
      gap: 8px;
    }

    .stage-item input[type="checkbox"] {
      flex-shrink: 0;
      width: 16px;
      height: 16px;
      margin: 0;
      cursor: pointer;
    }

    .stage-text {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .stage-number {
      font-weight: bold;
      min-width: 20px;
      text-align: right;
    }

    .stage-color {
      width: 12px;
      height: 12px;
      display: none;
      flex-shrink: 0;
      border: 1px solid rgba(0, 0, 0, 0.1);
      border-radius: 2px;
    }
  </style>
</head>

<body>
  <h2>Edit Demand: {{ demand.name }}</h2>

  {% if messages %}
  {% for message in messages %}
  <div style="color: green; margin-bottom: 1rem;">{{ message }}</div>
  {% endfor %}
  {% endif %}

  {% if form.errors %}
  <div style="color: red; margin-bottom: 1em;">
    <ul>
      {% for field in form %}
      {% for error in field.errors %}
      <li><strong>{{ field.label }}:</strong> {{ error }}</li>
      {% endfor %}
      {% endfor %}
      {% for error in form.non_field_errors %}
      <li>{{ error }}</li>
      {% endfor %}
    </ul>
  </div>
  {% endif %}

  <div class="main-content">
    <!-- Form Section -->
    <div class="form-container">
      <h3>Demand Details</h3>
      <form method="post">
        {% csrf_token %}
        <div class="form-content">
          <div class="form-fields">
            <div class="form-field">
              <label for="id_name">Name:</label>
              <input type="text" name="name" value="{{ form.name.value|default:'' }}" id="id_name" required>
            </div>
            <div class="form-field">
              <label for="id_demand_ID">Demand ID:</label>
              <input type="text" name="demand_ID" value="{{ form.demand_ID.value|default:'' }}" id="id_demand_ID"
                required>
            </div>
            <div class="form-field">
              <label for="id_demand_amount">Amount:</label>
              <input type="number" step="0.01" name="demand_amount" value="{{ form.demand_amount.value|default:'' }}"
                id="id_demand_amount" required>
            </div>
            <div class="form-field">
              <label for="id_file_type">Type of File:</label>
              {{ form.file_type }}
            </div>
            <div class="form-field" id="subtype_container">
              <label for="id_file_subtype">File Subtype:</label>
              {{ form.file_subtype }}
            </div>
            <div class="form-field" id="detail_container">
              <label for="id_file_detail">File Detail:</label>
              {{ form.file_detail }}
            </div>
            <div class="form-field">
              <label for="id_io_name">IO:</label>
              <input type="text" name="io_name" value="{{ form.io_name.value|default:'' }}" id="id_io_name" required>
            </div>
            <div class="form-field">
              <label for="id_start_date">Start Date:</label>
              <input type="date" name="start_date" value="{{ form.start_date.value|date:'Y-m-d' }}" id="id_start_date">
            </div>
            <div class="form-field">
              <label for="id_duration_months">Duration (months):</label>
              <input type="number" name="duration_months" value="{{ form.duration_months.value|default:'' }}"
                id="id_duration_months" min="1">
            </div>
            <div class="form-field submit-btn">
              <input type="submit" value="Save Changes" />
            </div>
          </div>

          <div class="stage-section">
            <h3>Stage Legend Checklist</h3>
            <div class="stage-list">
              <!-- Column 1: Stages 0-9 -->
              <div class="stage-column">
                <!-- Stage 0 - Demand to be Initiated -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_demand_to_be_initiated" class="stage-checkbox" data-stage="demand_to_be_initiated" {% if 'demand_to_be_initiated' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #1f78b4;"></span>
                      <span class="stage-number">0.</span>
                      <span>Demand to be Initiated</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 1 - Demand Initiated -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_demand_initiated" class="stage-checkbox" data-stage="demand_initiated" {% if 'demand_initiated' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #33a02c;"></span>
                      <span class="stage-number">1.</span>
                      <span>Demand Initiated</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 2 - SPC Cleared -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_spc_cleared" class="stage-checkbox" data-stage="spc_cleared" {% if 'spc_cleared' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fb9a99;"></span>
                      <span class="stage-number">2.</span>
                      <span>SPC Cleared</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 3 - Demand Approved -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_demand_approved" class="stage-checkbox" data-stage="demand_approved" {% if 'demand_approved' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #e31a1c;"></span>
                      <span class="stage-number">3.</span>
                      <span>Demand Approved</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 4 - Tender Enquiry Floated -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_tender_enquiry_floated" class="stage-checkbox" data-stage="tender_enquiry_floated" {% if 'tender_enquiry_floated' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fdbf6f;"></span>
                      <span class="stage-number">4.</span>
                      <span>Tender Enquiry Floated</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 5 - Receipt of Quotations -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_receipt_of_quotations" class="stage-checkbox" data-stage="receipt_of_quotations" {% if 'receipt_of_quotations' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #ff7f00;"></span>
                      <span class="stage-number">5.</span>
                      <span>Receipt of Quotations</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 6 - Tender Opening -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_tender_opening" class="stage-checkbox" data-stage="tender_opening" {% if 'tender_opening' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #cab2d6;"></span>
                      <span class="stage-number">6.</span>
                      <span>Tender Opening</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 7 - TCEC Approved -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_tcec_approved" class="stage-checkbox" data-stage="tcec_approved" {% if 'tcec_approved' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #6a3d9a;"></span>
                      <span class="stage-number">7.</span>
                      <span>TCEC Approved</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 8 - TPC Approved -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_tpc_approved" class="stage-checkbox" data-stage="tpc_approved" {% if 'tpc_approved' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #b2df8a;"></span>
                      <span class="stage-number">8.</span>
                      <span>TPC Approved</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 9 - Financial Sanction -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_financial_sanction" class="stage-checkbox" data-stage="financial_sanction" {% if 'financial_sanction' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #a6cee3;"></span>
                      <span class="stage-number">9.</span>
                      <span>Financial Sanction</span>
                    </div>
                  </label>
                </div>
              </div>
  
              <!-- Column 2: Stages 10-19 -->
              <div class="stage-column">
                <!-- Stage 10 - Order Placement -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_order_placement" class="stage-checkbox" data-stage="order_placement" {% if 'order_placement' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #1f78b4;"></span>
                      <span class="stage-number">10.</span>
                      <span>Order Placement</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 11 - PDR -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_pdr" class="stage-checkbox" data-stage="pdr" {% if 'pdr' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #33a02c;"></span>
                      <span class="stage-number">11.</span>
                      <span>PDR</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 12 - SO for Critical BoM by Dev Partner -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_so_for_critical_bom_by_dev_partner" class="stage-checkbox" data-stage="so_for_critical_bom_by_dev_partner" {% if 'so_for_critical_bom_by_dev_partner' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fb9a99;"></span>
                      <span class="stage-number">12.</span>
                      <span>SO for Critical BoM by Dev Partner</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 13 - DDR -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_ddr" class="stage-checkbox" data-stage="ddr" {% if 'ddr' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #e31a1c;"></span>
                      <span class="stage-number">13.</span>
                      <span>DDR</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 14 - CDR -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_cdr" class="stage-checkbox" data-stage="cdr" {% if 'cdr' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fdbf6f;"></span>
                      <span class="stage-number">14.</span>
                      <span>CDR</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 15 - Acceptance of Critical BoM by Dev Partner -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_acceptance_of_critical_bom_by_dev_partner" class="stage-checkbox" data-stage="acceptance_of_critical_bom_by_dev_partner" {% if 'acceptance_of_critical_bom_by_dev_partner' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #ff7f00;"></span>
                      <span class="stage-number">15.</span>
                      <span>Acceptance of Critical BoM by Dev Partner</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 16 - Realization Completed -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_realization_completed" class="stage-checkbox" data-stage="realization_completed" {% if 'realization_completed' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #cab2d6;"></span>
                      <span class="stage-number">16.</span>
                      <span>Realization Completed</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 17 - FAT Completed -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_fat_completed" class="stage-checkbox" data-stage="fat_completed" {% if 'fat_completed' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #6a3d9a;"></span>
                      <span class="stage-number">17.</span>
                      <span>FAT Completed</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 18 - ATP/QTP Completed -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_atp_qtp_completed" class="stage-checkbox" data-stage="atp_qtp_completed" {% if 'atp_qtp_completed' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #b2df8a;"></span>
                      <span class="stage-number">18.</span>
                      <span>ATP/QTP Completed</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 19 - Delivery at Stores -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_delivery_at_stores" class="stage-checkbox" data-stage="delivery_at_stores" {% if 'delivery_at_stores' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #a6cee3;"></span>
                      <span class="stage-number">19.</span>
                      <span>Delivery at Stores</span>
                    </div>
                  </label>
                </div>
              </div>
  
              <!-- Column 3: Stages 20-25 -->
              <div class="stage-column">
                <!-- Stage 20 - SAT/SoFT -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_sat_soft" class="stage-checkbox" data-stage="sat_soft" {% if 'sat_soft' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #1f78b4;"></span>
                      <span class="stage-number">20.</span>
                      <span>SAT/SoFT</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 21 - Inward Inspection Clearance -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_inward_inspection_clearance" class="stage-checkbox" data-stage="inward_inspection_clearance" {% if 'inward_inspection_clearance' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #b2df8a;"></span>
                      <span class="stage-number">21.</span>
                      <span>Inward Inspection Clearance</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 22 - Payment Process -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_payment_process" class="stage-checkbox" data-stage="payment_process" {% if 'payment_process' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fb9a99;"></span>
                      <span class="stage-number">22.</span>
                      <span>Payment Process</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 23 - Partially Paid -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_partially_paid" class="stage-checkbox" data-stage="partially_paid" {% if 'partially_paid' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #e31a1c;"></span>
                      <span class="stage-number">23.</span>
                      <span>Partially Paid</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 24 - Payment Released -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_payment_released" class="stage-checkbox" data-stage="payment_released" {% if 'payment_released' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #fdbf6f;"></span>
                      <span class="stage-number">24.</span>
                      <span>Payment Released</span>
                    </div>
                  </label>
                </div>
  
                <!-- Stage 25 - Available for Integration -->
                <div class="stage-item">
                  <label>
                    <input type="checkbox" name="stage_available_for_integration" class="stage-checkbox" data-stage="available_for_integration" {% if 'available_for_integration' in demand.selected_stages %}checked{% endif %}>
                    <div class="stage-text">
                      <span class="stage-color" style="background-color: #ff7f00;"></span>
                      <span class="stage-number">25.</span>
                      <span>Available for Integration</span>
                    </div>
                  </label>
                </div>
              </div>
            </div>
          </div>
        </form>
      </div>
      <a href="{% url 'demand_list' %}">Back to timeline</a>
  

  <script>
    // JavaScript to handle the multi-level dropdown functionality
    document.addEventListener('DOMContentLoaded', function () {
      const fileTypeSelect = document.getElementById('id_file_type');
      const subtypeSelect = document.getElementById('id_file_subtype');
      const detailSelect = document.getElementById('id_file_detail');
      const subtypeContainer = document.getElementById('subtype_container');
      const detailContainer = document.getElementById('detail_container');

      // Initially show the subtype container
      subtypeContainer.style.display = 'block';

      // Initially set visibility of detail container based on current subtype
      updateDetailVisibility();

      // Add event listener to file type dropdown
      fileTypeSelect.addEventListener('change', function () {
        // Always show the subtype container when file type changes
        subtypeContainer.style.display = 'block';
        // Reset subtype selection
        subtypeSelect.selectedIndex = 0;
        // Reset detail selection
        detailSelect.selectedIndex = 0;
        // Update detail visibility
        updateDetailVisibility();
      });

      // Add event listener to subtype dropdown
      subtypeSelect.addEventListener('change', function () {
        // Reset detail selection
        detailSelect.selectedIndex = 0;
        // Update detail visibility
        updateDetailVisibility();
      });

      // Function to update the visibility of the detail dropdown
      function updateDetailVisibility() {
        if (subtypeSelect.value === 'Project') {
          detailContainer.style.display = 'block';
        } else {
          detailContainer.style.display = 'none';
          // Reset detail selection when not visible
          detailSelect.selectedIndex = 0;
        }
      }
    });
  </script>
</body>

</html>